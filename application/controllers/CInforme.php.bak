<?php
defined('BASEPATH') or exit('No direct script access allowed');

class CInforme extends CI_Controller
{

    public function __construct()
    {
        parent::__construct();
        $this->load->helper("url");
        $this->load->model("MInforme");
    }

    public function index()
    {

        $data['title'] = 'IPS | INFORMES';

        $this->load->view("CPlantilla/VHead", $data);

        $this->load->view("CPlantilla/VBarraMenu");

        $this->load->view("CInforme/VConsultar.php");

        $this->load->view("CPlantilla/VFooter");
    }

public function informe1()
    {

        $data['title'] = 'IPS | INFORMES';

        $this->load->view("CPlantilla/VHead", $data);

        $this->load->view("CPlantilla/VBarraMenu");

        $this->load->view("CInforme/VConsultar1.php");

        $this->load->view("CPlantilla/VFooter");
    }


    public function exportar() {
        // create file name
        $filename = date('Y-m-d',time()).'.xls';  

        $fecha1 = $this->input->post('fecha');
        $fecha2 = $this->input->post('fecha1');
        $data = $this->MInforme->ver_pac_by_fecha($fecha1, $fecha2);


        header("Pragma: public");
        header("Expires: 0");
        header("Content-type: application/x-msdownload");
        header("Content-Disposition: attachment; filename=$filename");
        header("Pragma: no-cache");
        header("Cache-Control: must-revalidate, post-check=0, pre-check=0");


        echo "<table border=1";
        if (sizeof($data) > 0) {
            echo "<tr >";
            echo "<td>Primer Nombre</td>";
            echo "<td>Segundo Nombre</td>";
            echo "<td>Primer Apellido</td>";
            echo "<td>Segundo Apellido</td>";
            echo "<td>Tipo Id</td>";
            echo "<td>Numero de Identificacion</td>";
            echo "<td>Fecha de Nacimiento</td>";
            echo "<td>Edad</td>";
            echo "<td>Sexo</td>";
            echo "<td>Genero</td>";
            echo "<td>Grupo Etnico</td>";
            echo "<td>Grupo Poblacion</td>";
            echo "<td>Orientacion Sexual</td>";
            echo "<td>Tipos de Discapacidad</td>";
            echo "<td>Codigo Ocupacion</td>";
            echo "<td>Escolaridad</td>";
            echo "<td>Codigo DANE Municipio de Residencia</td>";
            echo "<td>Descripcion Municipio de Residencia</td>";
            echo "<td>Zona</td>";
            echo "<td>Direccion de Residencia</td>";
            echo "<td>Numero de Telefono</td>";
            echo "<td>Codigo Habilitacion IPS de Atencion</td>";
            echo "<td>Nombre IPS Atencion</td>";
            echo "<td>Fecha de Ingreso al Programa</td>";
            echo "<td>Diagnostico HTA</td>";
            echo "<td>Fecha Diagnostico HTA</td>";
            echo "<td>Diagnostico DM</td>";
            echo "<td>Fecha Diagnostico DM</td>";
            echo "<td>Tipo de Diabetes</td>";
            echo "<td>Diagnostico EPOC</td>";
            echo "<td>Fecha Diagnostico de EPOC</td>";
            echo "<td>Diagnostico ERC</td>";
            echo "<td>Fecha Diagnostico ERC</td>";
            echo "<td>Dx Enfermedad Cardiaca Isquemica</td>";
            echo "<td>Dx Enfermedad Cerebrovascular</td>";
            echo "<td>Dx Enfermedad Arterial Periferica</td>";
            echo "<td>Dx Insuficiencia Cardiaca</td>";
            echo "<td>Dx Retinopatia</td>";
            echo "<td>Dx Aterosclerosis</td>";
            echo "<td>Discapacidad</td>";
            echo "<td>Habito Tabaquico</td>";
            echo "<td>Cocina con Leña</td>";
            echo "<td>Fecha de Control</td>";
            echo "<td>Peso (kg)</td>";
            echo "<td>Talla (cms)</td>";
            echo "<td>IMC</td>";
            echo "<td>Perimetro de Cintura</td>";
            echo "<td>Presion Arterial Sistolica</td>";
            echo "<td>Presion Arterial Diastolica</td>";
            echo "<td>Colesterol Total</td>";
            echo "<td>Fecha Colesterol Total</td>";
            echo "<td>Colesterol HDL</td>";
            echo "<td>Fecha Colesterol HDL</td>";
            echo "<td>Colesterol LDL</td>";
            echo "<td>Fecha Colesterol LDL</td>";
            echo "<td>Trigliceridos</td>";
            echo "<td>Fecha Trigliceridos</td>";
            echo "<td>Hemoglobina Glicosilada</td>";
            echo "<td>Fecha Hemoglobina Glicosilada</td>";
            echo "<td>Creatinina Serica N 1</td>";
            echo "<td>Fecha Creatinina Serica N 1</td>";
            echo "<td>Creatinina Serica N 2</td>";
            echo "<td>Fecha Creatinina Serica N 2</td>";
            echo "<td>Creatinina Serica N 3</td>";
            echo "<td>Fecha Creatinina Serica N 3</td>";
            echo "<td>Albuminuria/Creatinuria N 1</td>";
            echo "<td>Fecha Cociente Albuminuria/Creatinuria N 1</td>";
            echo "<td>Albuminuria/Creatinuria N 2</td>";
            echo "<td>Fecha Cociente Albuminuria/Creatinuria N 2</td>";
            echo "<td>Albuminuria/Creatinuria N 3</td>";
            echo "<td>Fecha Cociente Albuminuria/Creatinuria N 3</td>";
            echo "<td>Uroanalsis</td>";
            echo "<td>Fecha Uroanalisis</td>";
            echo "<td>TFG COCKCROFT-GAULT N 1</td>";
            echo "<td>TFG COCKCROFT-GAULT N 2</td>";
            echo "<td>TFG COCKCROFT-GAULT N 3</td>";
            echo "<td>Albuminuria</td>";
            echo "<td>Fecha Albuminuria</td>";
            echo "<td>Estadio ERC</td>";
            echo "<td>Paratohormona (PTH)</td>";
            echo "<td>Fecha PTH</td>";
            echo "<td>Hemoglobina</td>";
            echo "<td>Fecha hemoglobina</td>";
            echo "<td>Albumina Serica</td>";
            echo "<td>Fecha Albumina</td>";
            echo "<td>Fosforo</td>";
            echo "<td>Fecha Fosforo</td>";
            echo "<td>Paciente Recibe IECA</td>";
            echo "<td>Paciente Recibe ARA</td>";
            echo "<td>Paciente Recibe Insulina</td>";
            echo "<td>Adherencia al Tratamiento (Test de Morinsky)</td>";
            echo "<td>Clasificacion del Riesgo Cardiovascular</td>";
            echo "<td>Clasificacion del Estado Metabolico</td>";
            echo "<td>Novedades</td>";
            echo "<td>Fecha de Muerte</td>";
            echo "<td>Fecha de Observacion</td>";
            echo "<td>Observacion</td>";
            echo "<td>Municipio Atencion</td>";
            echo "<td>ESTADIO ERC CKD EPI</td>";
            echo "<td>CRUCE NOVEDAD 2</td>";
            echo "<td>OBSERVACION</td>";
            echo "<td>Hierro Serico</td>";
            echo "<td>Fecha Hierro Serico</td>";
            echo "<td>BUN</td>";
            echo "<td>Fecha BUN</td>";
            echo "<td>Potasio Serico</td>";
            echo "<td>Fecha Potasio Serico</td>";
            echo "<td>Proteinuria Orina</td>";
            echo "<td>Fecha Proteinuria Orina</td>";
            echo "<td>Sodio en Suero</td>";
            echo "<td>Fecha Sodio en Suero</td>";
            echo "<td>TSH Ultrasensible</td>";
            echo "<td>Fecha TSH Ultrasensible</td>";
            echo "<td>Transferrina</td>";
            echo "<td>Fecha Transferrina</td>";
            echo "<td>Calcio Sangre</td>";
            echo "<td>Fecha Calcio Sangre</td>";
            echo "<td>Acido Urico</td>";
            echo "<td>Fecha Acido Urico</td>";
            echo "<td>Fosfatasa</td>";
            echo "<td>Fecha Fosfatasa</td>";
            echo "<td>Hematocrito</td>";
            echo "<td>Fecha Hematocrito</td>";
            echo "<td>Fecha Uroanalisis</td>";
            echo "<td>Glucosa</td>";
            echo "<td>Fecha Glucosa</td>";
            echo "<td>Creatinuria en orina</td>";
            echo "<td>Fecha Creatinuria en orina</td>";
            echo "<td>BRIGADA</td>";
            echo "<td>ZONA</td>";
            echo "<td>AUXILIAR</td>";
            echo "<td>Contrato</td>";
            echo "<td>AR</td>";
			echo "<td>TIPO DE CONSULTA</td>";
           
            echo "<td>FECHA ACTUAL</td>";
            echo "<td>FECHA FINAL</td>";
			echo "<td>MEDICO</td>";
            echo "<td>APELLIDO</td>";
            echo "</tr>"; 
            echo "<tbody>";
            foreach ($data as $d) {
                list($anio, $mes, $dia) = explode("-", $d->pacFecNacimiento);
                $anio_dif = date("Y") - $anio;
                $mes_dif = date("m") - $mes;
                $dia_dif = date("d") - $dia;

                if($d->pacSexo == 'M'){
                    $sexo = 'Hombre';
                }else{
                    $sexo = 'Mujer';
                } 

                if ($dia_dif < 0 || $mes_dif < 0) {
                    $anio_dif--;
                            //return $anio_dif;
                }
                echo "<tr>";
                echo "<td>" . $d->pacNombre . "</td>";
                echo "<td>" . $d->pacNombre2 . "</td>";
                echo "<td>" . $d->pacApellido . "</td>";
                echo "<td>" . $d->pacApellido2 . "</td>";
                echo "<td>" . $d->nom_abreviacion . "</td>";
                echo "<td>" . $d->pacDocumento . "</td>";
                echo "<td>" . $d->pacFecNacimiento . "</td>";
                echo "<td>" . $anio_dif ."</td>";
                echo "<td>" . $sexo ."</td>";
                echo "<td>" . $d->pacSexo . "</td>";
                echo "<td>Grupo Etnico</td>";
                echo "<td>Grupo Poblacion</td>";
                echo "<td>Orientacion Sexual</td>";
                echo "<td>Tipos de Discapacidad</td>";
                echo "<td>" . $d->ocuCodigo . "</td>";
                echo "<td>" . $d->escNombre . "</td>";
                echo "<td>Codigo DANE Municipio de Residencia</td>";
                echo "<td>" . $d->municipio_residencia . "</td>";
                echo "<td>" . $d->zonNombre . "</td>";
                echo "<td>" . $d->pacDireccion . "</td>";
                echo "<td>" . $d->pacTelefono . "</td>";
                echo "<td>". $d->empCodigo ."</td>";
                echo "<td>" . $d->empNombre . "</td>";
                echo "<td>Fecha de Ingreso al Programa </td>";
                echo "<td>" . $d->hcHipertensionArterialPersonal . "</td>";
                echo "<td>" . $d->citFecha . "</td>";
                echo "<td>" . $d->hcDiabetesMellitusPersonal . "</td>";
                echo "<td>" . $d->citFecha . "</td>";
                echo "<td>" . $d->hcClasificacionDm . "</td>";
                echo "<td>Diagnostico EPOC</td>";
                echo "<td>Fecha Diagnostico EPOC</td>";
                echo "<td>" . $d->hcClasificacionErcEstado . "</td>";
                echo "<td>" . $d->citFecha . "</td>";
                echo "<td>Dx Enfermedad Cardiaca Isquemica</td>";
                echo "<td>Dx Enfermedad Cerebrovascular</td>";
                echo "<td>Dx Enfermedad Arterial Periferica</td>";
                echo "<td>Dx Insuficiencia Cardiaca</td>";
                echo "<td>Dx Retinopatia</td>";
                echo "<td>Dx Aterosclerosis</td>";
                echo "<td>Discapacidad</td>";
                echo "<td>" . $d->hcTabaquismo . "</td>";
                echo "<td>Cocina con Leña</td>";
                echo "<td>" . $d->citFecha . "</td>";
                echo "<td>" . $d->hcPeso . "</td>";
                echo "<td>" . $d->hcTalla . "</td>";
                echo "<td>" . $d->hcIMC . "</td>";
                echo "<td>" . $d->hcPerimetroAbdominal . "</td>";
                echo "<td>" . $d->hcPresionArterialSistolicaSentadoPie . "</td>";
                echo "<td>" . $d->hcPresionArterialDistolicaSentadoPie . "</td>";
                echo "<td>Colesterol Total</td>";
                echo "<td>Fecha Colesterol Total</td>";
                echo "<td>Colesterol HDL</td>";
                echo "<td>Fecha Colesterol HDL</td>";
                echo "<td>Colesterol LDL</td>";
                echo "<td>Fecha Colesterol LDL</td>";
                echo "<td>Trigliceridos</td>";
                echo "<td>Fecha Trigliceridos</td>";
                echo "<td>Hemoglobina Glicosilada</td>";
                echo "<td>Fecha Hemoglobina Glicosilada</td>";
                echo "<td>Creatinina Serica N 1</td>";
                echo "<td>Fecha Creatinina Serica N 1</td>";
                echo "<td>Creatinina Serica N 2</td>";
                echo "<td>Fecha Creatinina Serica N 2</td>";
                echo "<td>Creatinina Serica N 3</td>";
                echo "<td>Fecha Creatinina Serica N 3</td>";
                echo "<td>Albuminuria/Creatinuria N 1</td>";
                echo "<td>Fecha Cociente Albuminuria/Creatinuria N 1</td>";
                echo "<td>Albuminuria/Creatinuria N 2</td>";
                echo "<td>Fecha Cociente Albuminuria/Creatinuria N 2</td>";
                echo "<td>Albuminuria/Creatinuria N 3</td>";
                echo "<td>Fecha Cociente Albuminuria/Creatinuria N 3</td>";
                echo "<td>Uroanalsis</td>";
                echo "<td>Fecha Uroanalisis</td>";
                echo "<td>" . $d->tasa_filtracion_glomerular_gockcroft_gault . "</td>";
                echo "<td>TFG COCKCROFT-GAULT N 2</td>";
                echo "<td>TFG COCKCROFT-GAULT N 3</td>";
                echo "<td>Albuminuria</td>";
                echo "<td>Fecha Albuminuria</td>";
                echo "<td>Estadio ERC</td>";
                echo "<td>Paratohormona (PTH)</td>";
                echo "<td>Fecha PTH</td>";
                echo "<td>Hemoglobina</td>";
                echo "<td>Fecha hemoglobina</td>";
                echo "<td>Albumina Serica</td>";
                echo "<td>Fecha Albumina</td>";
                echo "<td>Fosforo</td>";
                echo "<td>Fecha Fosforo</td>";
                echo "<td>Paciente Recibe IECA</td>";
                echo "<td>Paciente Recibe ARA</td>";
                echo "<td>" . $d->insulina_requiriente . "</td>";
                echo "<td>" . $d->adherente . "</td>";
                echo "<td>" . $d->hcClasificacionRcv . "</td>";
                echo "<td>" . $d->hcClasificacionEstadoMetabolico . "</td>";
                echo "<td>Novedades</td>";
                echo "<td>Fecha de Muerte</td>";
                echo "<td>Fecha de Observacion</td>";
                echo "<td>Observacion</td>";
                echo "<td>Municipio Atencion</td>";
                echo "<td>" . $d->hcClasificacionErcCategoriaAmbulatoriaPersistente . "</td>";
                echo "<td>CRUCE NOVEDAD 2</td>";
                echo "<td>OBSERVACION</td>";
                echo "<td>Hierro Serico</td>";
                echo "<td>Fecha Hierro Serico</td>";
                echo "<td>BUN</td>";
                echo "<td>Fecha BUN</td>";
                echo "<td>Potasio Serico</td>";
                echo "<td>Fecha Potasio Serico</td>";
                echo "<td>Proteinuria Orina</td>";
                echo "<td>Fecha Proteinuria Orina</td>";
                echo "<td>Sodio en Suero</td>";
                echo "<td>Fecha Sodio en Suero</td>";
                echo "<td>TSH Ultrasensible</td>";
                echo "<td>Fecha TSH Ultrasensible</td>";
                echo "<td>Transferrina</td>";
                echo "<td>Fecha Transferrina</td>";
                echo "<td>Calcio Sangre</td>";
                echo "<td>Fecha Calcio Sangre</td>";
                echo "<td>Acido Urico</td>";
                echo "<td>Fecha Acido Urico</td>";
                echo "<td>Fosfatasa</td>";
                echo "<td>Fecha Fosfatasa</td>";
                echo "<td>Hematocrito</td>";
                echo "<td>Fecha Hematocrito</td>";
                echo "<td>Fecha Uroanalisis</td>";
                echo "<td>Glucosa</td>";
                echo "<td>Fecha Glucosa</td>";
                echo "<td>Creatinuria en orina</td>";
                echo "<td>Fecha Creatinuria en orina</td>";
                echo "<td>BRIGADA</td>";
                echo "<td>ZONA</td>";
                echo "<td>" . $d->usu_creo_cita . "</td>";
                echo "<td>" . $d->proceso_idProceso . "</td>";
                echo "<td>AR</td>";
				echo "<td>" . $d->cupNombre . "</td>";
             
                echo "<td>" . $d->fecha_actual . "</td>"; 
				echo "<td>" . $d->fecha_final. "</td>";
				echo "<td>" . $d->usuNombre .  "</td>";
                echo "<td>" . $d->usuApellido . "</td>";
                echo "</tr>";
            }
            echo "</tbody>";
        } else {
            echo "<tr><td>No se encontro ningun procedimiento de facturacion pendiente para este usuario.</td></tr>";
        }

        echo "</table>";

    }



public function exportar_1() {
    // create file name
    $filename = date('Y-m-d',time()).'.xls';  

    $fecha1 = $this->input->post('fecha');
    $fecha2 = $this->input->post('fecha1');
    $data = $this->MInforme->ver_pac_by_fecha($fecha1, $fecha2);


    header("Pragma: public");
    header("Expires: 0");
    header("Content-type: application/x-msdownload");
    header("Content-Disposition: attachment; filename=$filename");
    header("Pragma: no-cache");
    header("Cache-Control: must-revalidate, post-check=0, pre-check=0");


    echo "<table border=1";
    if (sizeof($data) > 0) {
        echo "<tr >";
        echo "<td>Nombre</td>";
        echo "<td>Tipo Documento</td>";
        echo "<td>Numero de Identificacion</td>";
         echo "<td>Edad</td>";
        echo "<td>Genero</td>";
        echo "<td>Departamento Afiliado</td>";
        echo "<td>Municipio Afiliado</td>";
        echo "<td>Telefono</td>";
        echo "<td>Fecha Solicitud Cita</td>";
        echo "<td>Fecha en que el usuario solicita le sea asignada la cita (fecha deseada)</td>";
        echo "<td>Fecha para la cual se asigna la cita</td>";
        echo "<td>Departamento IPS</td>";
        echo "<td>NIT</td>";
        echo "<td>Codigo Habilitacion</td>";
        echo "<td>Razon Social de Institución prestadora de servicios</td>";
        echo "<td>Servicio Solicitado</td>";
        echo "<td>Regimen</td>";
        echo "<td>Cups</td>";
        echo "<td>Zona</td>";
        echo "<td>FECHA ACTUAL</td>";
        echo "<td>FECHA FINAL</td>";
        echo "<td>MEDICO</td>";
        echo "<td>ID AUX</td>";
     
        echo "</tr>"; 
        echo "<tbody>";
        foreach ($data as $d) {
            list($anio, $mes, $dia) = explode("-", $d->pacFecNacimiento);
            $anio_dif = date("Y") - $anio;
            $mes_dif = date("m") - $mes;
            $dia_dif = date("d") - $dia;

            if($d->pacSexo == 'M'){
                $sexo = 'Hombre';
            }else{
                $sexo = 'Mujer';
            } 

            if ($dia_dif < 0 || $mes_dif < 0) {
                $anio_dif--;
                        //return $anio_dif;
            }
            echo "<tr>";
            echo "<td>" . $d->pacNombre ." ". $d->pacNombre2 ." ". $d->pacApellido ." ". $d->pacApellido2 . "</td>";
            echo "<td>" . $d->nom_abreviacion . "</td>";
            echo "<td>" . $d->pacDocumento . "</td>";
			 echo "<td>" . $anio_dif ."</td>";
            echo "<td>" . $d->pacSexo . "</td>";
            echo "<td>" . $d->depNombre . "</td>";
            echo "<td>" . $d->munNombre . "</td>";
            echo "<td>" . $d->pacTelefono . "</td>";  
            echo "<td>" . $d->citFecha . "</td>";     
            echo "<td>" . $d->citFechaDeseada . "</td>";  
            echo "<td>" . $d->citFechaInicio . "</td>";
            echo "<td>Cauca</td>";
            echo "<td>900817959</td>";  
            echo "<td>190010882401</td>";
            echo "<td>Fundacion Nacer Para Vivir IPS</td>";
            echo "<td>" . $d->proNombre . "</td>";
            echo "<td>" . $d->regNombre . "</td>"; 
            echo "<td>" . $d->N_cups. "</td>"; 
            echo "<td>" . $d->zonNombre. "</td>";                  
            echo "<td>" . $d->fecha_actual . "</td>"; 
            echo "<td>" . $d->fecha_final. "</td>";
            echo "<td>" . $d->usuNombre ." " . $d->usuApellido .   " </td>";
           
            echo "<td>" . $d->auxiliar_idauxiliar ." </td>";
            
           
            echo "</tr>";
        }
        echo "</tbody>";
    } else {
        echo "<tr><td>No se encontro ningun procedimiento de facturacion pendiente para este usuario.</td></tr>";
    }

    echo "</table>";

}
}

